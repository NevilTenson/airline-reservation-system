<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard</title>
  <!-- Fix CSS path -->
  <link rel="stylesheet" href="./styles/main.css" />
  <style>
    /* Tabs and Panels */
    .tabs { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; border-bottom: 1px solid #eef3f8; padding-bottom: 8px;}
    .tab-btn { padding: 8px 12px; border-radius: 8px 8px 0 0; border: 1px solid #e6eef8; border-bottom: none; cursor: pointer; background: #f8faff; color: var(--primary); margin-bottom: -1px;}
    .tab-btn.active { background: var(--card); border-color: #e6eef8; position: relative; font-weight: 600; }
    .panel { display: none; padding-top: 16px; }
    .panel.active { display: block; }

    /* Forms */
    .form-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-end; }
    .form-row input, .form-row select { flex: 1; min-width: 140px; }
    .form-row button { height: fit-content; }
    .form-stack { display: flex; flex-direction: column; gap: 10px; }

    /* Lists and Cards */
    .list-item-card { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eef3f8; gap: 10px; flex-wrap: wrap;}
    .list-item-card:last-child { border-bottom: none; }
    .list-item-card .flight-sub { font-size: 13px; color: var(--muted); }
    .list-item-card .actions { flex-shrink: 0; /* Prevent buttons shrinking */ }

    /* Specific Layouts */
    .admin-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 16px; }
    .card.wide { grid-column: 2 / 3; grid-row: 1 / span 2; }
    @media (max-width: 820px) {
      .admin-grid { grid-template-columns: 1fr; }
      .card.wide { grid-column: 1; grid-row: auto; }
    }

    /* Buttons */
    .btn.danger { background-color: var(--danger, #e53e3e); color: white; border-color: var(--danger, #e53e3e); }
    .btn.danger:hover { background-color: #c53030; border-color: #c53030; }

    /* Ticket Card */
    .ticket-card { position: relative; margin-top: 16px; } /* Added margin */
    .ticket-card .actions { position: absolute; top: 10px; right: 10px; z-index: 1; }

    /* Reports Section */
    .report-user-card { margin-bottom: var(--gap, 16px); background-color: #f8fbff; border-left: 4px solid var(--primary, #0b5ed7); padding: 15px; }
    .report-user-card h3 { margin-bottom: 10px; color: var(--primary, #0b5ed7); }
    .report-user-card p { margin: 4px 0; font-size: 0.95rem; line-height: 1.5; }
    #reports-result h3 { margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; color: #333; border-bottom: 1px solid #eef3f8; padding-bottom: 5px; }
    #reports-result .ticket-card { margin-top: var(--gap, 16px); }
    #reports-result .list-item-card { margin-top: 8px; background-color: #fff; border: 1px solid #eef3f8; border-radius: 8px; padding: 12px; } /* Style assigned flights */
    #reports-result .list-item-card strong { color: var(--primary, #0b5ed7); }

    /* Message Boxes */
    .message-box { padding: 12px; border-radius: 8px; margin-bottom: 16px; border: 1px solid transparent; display: block; opacity: 1; transition: opacity 0.5s ease-out; }
    .message-box.hidden { display: none; opacity: 0; }
    .message-box.success { background-color: #e6fffa; border-color: #b3f5e9; color: #237b6a; }
    .message-box.error { background-color: #fff6f6; border-color: #ffe6e6; color: var(--danger, #dc3545); }
    .message-box.info { background-color: #ebf8ff; border-color: #bee3f8; color: #2b6cb0; }
    .card.error-box, .card.info-box { margin-top: 16px; } /* Style card messages */
    .error-box { background-color: #fff6f6; border-color: #ffe6e6; color: var(--danger, #dc3545);}
    .info-box { background-color: #ebf8ff; border-color: #bee3f8; color: #2b6cb0;}

    /* Pilot Assignment */
    .pilot-assign-select { flex-grow: 2 !important; } /* Ensure dropdown takes space */
    .assign-pilot-btn { flex-grow: 1 !important; }

    /* Access Denied */
    .access-denied { padding: 18px; border-radius: 10px; background: #fff6f6; border: 1px solid #ffe6e6; color: var(--danger); }
  </style>
</head>
<body>
  <nav>
    <ul>
      <li><a href="/home.html">My Airline</a></li>
      <li id="nav-search"><a href="/search.html">Search Flights</a></li>
      <li id="nav-bookings" class="hidden"><a href="/bookings.html">My Bookings</a></li>
      <li id="nav-admin" class="hidden"><a href="/admin.html">Admin</a></li>
      <li id="nav-login" class="hidden"><a href="/login.html">Login</a></li>
      <li id="nav-register" class="hidden"><a href="/register.html">Register</a></li>
      <li id="nav-logout" class="hidden"><button id="logout-btn">Logout</button></li>
      <!-- Profile Avatar Link -->
      <li id="nav-profile" class="hidden profile-avatar-li" style="margin-left: auto;">
        <a href="/profile.html" title="View Profile" class="profile-avatar-link">
          <div class="profile-avatar-icon">
            <span id="nav-profile-initial" class="profile-avatar-initial">?</span>
          </div>
        </a>
      </li>
    </ul>
  </nav>

  <main class="container">
    <header><h1>Admin Dashboard</h1></header>

    <section class="card">
      <div class="tabs" role="tablist" aria-label="Admin sections">
        <button class="tab-btn active" data-panel="users">Users</button>
        <button class="tab-btn" data-panel="airlines">Airlines</button>
        <button class="tab-btn" data-panel="airports">Airports</button>
        <button class="tab-btn" data-panel="flights">Flights</button>
        <button class="tab-btn" data-panel="classes">Classes</button>
        <button class="tab-btn" data-panel="tickets">Tickets</button>
        <button class="tab-btn" data-panel="reports">Reports</button>
      </div>

      <!-- Message area for feedback -->
      <div id="admin-message" class="message-box hidden"></div>

      <!-- Users Panel -->
      <div id="panel-users" class="panel active">
        <h2>Users</h2>
        <div id="users-list">Loading users...</div>
      </div>

      <!-- Airlines Panel -->
      <div id="panel-airlines" class="panel">
        <h2>Add Airline</h2>
        <form id="add-airline-form" class="form-row">
          <input name="name" placeholder="Airline name" required />
          <input name="code" placeholder="Code (e.g., AI)" maxlength="3" required />
          <input name="country" placeholder="Country" required />
          <button class="btn primary" type="submit">Add Airline</button>
        </form>
        <h2 style="margin-top: 20px;">All Airlines</h2>
        <div id="airlines-list">Loading airlines...</div>
      </div>

      <!-- Airports Panel -->
      <div class="panel" id="panel-airports">
        <div class="admin-grid">
          <section class="card">
            <h2>Add Airport</h2>
            <form id="add-airport-form" class="form-stack">
              <input type="text" name="airport_code" placeholder="Airport Code (e.g., DEL)" maxlength="3" required />
              <input type="text" name="name" placeholder="Full Name (e.g., Indira Gandhi Intl)" required />
              <input type="text" name="city" placeholder="City (e.g., Delhi)" required />
              <input type="text" name="country" placeholder="Country (e.g., India)" required />
              <button type="submit" class="btn primary">Add Airport</button>
            </form>
          </section>
          <section class="card wide">
            <h2>All Airports</h2>
            <div id="airports-list">Loading airports...</div>
          </section>
        </div>
      </div>

      <!-- Flights Panel -->
      <div id="panel-flights" class="panel">
         <h2>Add Flight</h2>
         <form id="add-flight-form" class="form-stack">
           <select name="airline_id" id="airline-select" required>
             <option value="">-- Select Airline --</option>
           </select>
           <select name="origin_code" id="flight-origin-select" required>
             <option value="">-- Select Origin --</option>
           </select>
           <select name="destination_code" id="flight-destination-select" required>
             <option value="">-- Select Destination --</option>
           </select>
           <input type="text" name="flightNumber" placeholder="Flight Number (e.g., AI101)" required />
           <input type="number" name="price" placeholder="Base Price (e.g., 5000)" required min="0" step="1"/>
           <div class="form-group">
             <label for="departureTime">Departure Time</label>
             <input type="datetime-local" id="departureTime" name="departureTime" required />
           </div>
           <div class="form-group">
             <label for="arrivalTime">Arrival Time</label>
             <input type="datetime-local" id="arrivalTime" name="arrivalTime" required />
           </div>
           <button type="submit" class="btn primary">Add Flight</button>
         </form>
        <h2 style="margin-top: 20px;">All Flights</h2>
        <div id="flights-list">Loading flights...</div>
      </div>

      <!-- Classes Panel -->
      <div id="panel-classes" class="panel">
        <h2>Add Class to Flight</h2>
        <form id="add-class-form" class="form-stack">
          <select name="flightId" id="class-flight-select" required>
            <option value="">-- Select a Flight --</option>
          </select>
          <select name="classType" required>
            <option value="">-- Select Class Type --</option>
            <option value="Economy">Economy</option>
            <option value="Business">Business</option>
            <option value="First">First</option>
          </select>
          <input type="number" name="total_seats" placeholder="Total Seats" required min="1" />
          <input type="number" name="fare" placeholder="Fare for this class" required min="0" step="1"/>
          <button type="submit" class="btn primary">Add Class</button>
        </form>
        <h2 style="margin-top: 20px;">All Classes</h2>
        <div id="classes-list">Loading classes...</div>
      </div>

      <!-- Tickets Panel -->
      <div id="panel-tickets" class="panel">
        <h2>All Tickets</h2>
        <div id="tickets-list">Loading tickets...</div>
      </div>

      <!-- Reports Panel -->
      <div id="panel-reports" class="panel">
        <h2>User/Pilot Reports</h2>
        <p class="small-note" style="margin-bottom: 12px;">
          Select a role and user/pilot to generate an activity report.
        </p>
        <form id="report-search-form" class="form-row">
          <select name="role" id="report-role-select" required>
            <option value="user" selected>User</option>
            <option value="pilot">Pilot</option>
            <option value="admin">Admin</option>
          </select>
          <select name="userId" id="report-name-select" required style="min-width: 250px;">
            <option value="">-- Select a user --</option>
          </select>
          <button class="btn primary" type="submit">Search Reports</button>
        </form>
        <div id="reports-result" style="margin-top: 16px;">
          <!-- Report results will be shown here -->
        </div>
      </div>

      <div class="small-note" style="margin-top: 16px">
        Admin actions are protected. Use an admin account.
      </div>
    </section>
  </main>

  <!-- Fix JavaScript paths - use relative paths -->
  <script type="module" src="./js/main.js"></script>
  <script type="module" src="./js/admin.js"></script> 

</body>
</html>

